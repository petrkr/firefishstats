<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Investiƒçn√≠ √∫ƒçet ‚Äì Statistiky</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h2 { margin-top: 2em; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 2em; }
        th, td { border: 1px solid #ccc; padding: 0.5em; text-align: left; }
        th { background-color: #f4f4f4; }
        .refresh-btn { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-bottom: 1em;
        }
        .refresh-btn:hover { background-color: #0056b3; }
        .refresh-btn:disabled { background-color: #6c757d; cursor: not-allowed; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .status.success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <h1>Statistiky investiƒçn√≠ho √∫ƒçtu</h1>
    
    <button id="refreshBtn" class="refresh-btn" onclick="refreshData()">üîÑ Aktualizovat data</button>
    <div id="status"></div>

    <ul>
        <li>Poƒçet vklad≈Ø: {{ stats.num_deposits }}</li>
        <li>Celkem vlo≈æeno: {{ stats.deposited_total }} CZK</li>
        <li>Poƒçet v√Ωbƒõr≈Ø: {{ stats.num_withdrawals }}</li>
        <li>Poƒçet investic: {{ stats.num_investments }}</li>
        <li>Vr√°cen√© investice: {{ stats.matched_investments }}</li>
        <li>Investov√°no: {{ stats.total_invested }} CZK</li>
        <li>Vr√°ceno: {{ stats.total_returned }} CZK</li>
        <li>Souƒçet zisk≈Ø z investic: <strong>{{ stats.total_profit }} CZK</strong></li>
        <li>Aktu√°ln√≠ stav √∫ƒçtu: <strong>{{ stats.current_balance }} CZK</strong></li>
    </ul>

    <h2>Investice a n√°vraty</h2>
    <table>
        <tr>
            <th>Remittance</th>
            <th>Investice (‚àí)</th>
            <th>N√°vraty (+)</th>
            <th>Vr√°cen√≠ p≈ôeplatku (‚àí)</th>
            <th>ƒåist√Ω zisk</th>
        </tr>
        {% for row in investment_rows %}
        <tr>
            <td>{{ row.remittance }}</td>
    
            <td>
                {% for tx in row.investments %}
                    <div>{{ tx.transactionId }} ‚Äì {{ tx.effectiveDate }} ‚Äì {{ tx.amount.value }} CZK</div>
                {% endfor %}
                <strong>Celkem: {{ row.invested_total }} CZK</strong>
            </td>
    
            <td>
                {% for tx in row.returns %}
                    <div>{{ tx.transactionId }} ‚Äì {{ tx.effectiveDate }} ‚Äì {{ tx.amount.value }} CZK</div>
                {% endfor %}
                <strong>Celkem: {{ row.returned_total }} CZK</strong>
            </td>
    
            <td>
                {% for tx in row.overpayments %}
                    <div>{{ tx.transactionId }} ‚Äì {{ tx.effectiveDate }} ‚Äì {{ tx.amount.value }} CZK</div>
                {% endfor %}
                <strong>Celkem: {{ row.overpaid_total }} CZK</strong>
            </td>
    
            <td>
                {% if row.profit is not none %}
                    <strong style="color: green">{{ "%.2f"|format(row.profit) }} CZK</strong>
                {% else %}
                    <em>zat√≠m nevr√°ceno</em>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
    

    <h2>Vklady</h2>
    <table>
        <tr>
            <th>ID</th><th>Datum</th><th>ƒå√°stka</th><th>Partner</th>
        </tr>
        {% for tx in deposits %}
        <tr>
            <td>{{ tx.transactionId }}</td>
            <td>{{ tx.effectiveDate }}</td>
            <td>{{ tx.amount.value }}</td>
            <td>{{ tx.partnerAccount.partnerName or '' }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>V√Ωbƒõry</h2>
    <table>
        <tr>
            <th>ID</th><th>Datum</th><th>ƒå√°stka</th><th>Partner</th>
        </tr>
        {% for tx in withdrawals %}
        <tr>
            <td>{{ tx.transactionId }}</td>
            <td>{{ tx.effectiveDate }}</td>
            <td>{{ tx.amount.value }}</td>
            <td>{{ tx.partnerAccount.partnerName or '' }}</td>
        </tr>
        {% endfor %}
    </table>

    <script>
    async function refreshData() {
        const btn = document.getElementById('refreshBtn');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        btn.textContent = '‚è≥ Naƒç√≠t√°m...';
        status.innerHTML = '';
        
        try {
            const response = await fetch('/api/refresh');
            const result = await response.json();
            
            if (result.success) {
                status.innerHTML = `<div class="status success">${result.message}</div>`;
                // Reload page after successful refresh
                setTimeout(() => window.location.reload(), 1500);
            } else {
                status.innerHTML = `<div class="status error">Chyba: ${result.error}</div>`;
            }
        } catch (error) {
            status.innerHTML = `<div class="status error">Chyba p≈ôi komunikaci se serverem: ${error.message}</div>`;
        } finally {
            btn.disabled = false;
            btn.textContent = 'üîÑ Aktualizovat data';
        }
    }
    </script>
</body>
</html>
